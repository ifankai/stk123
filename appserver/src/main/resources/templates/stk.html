<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:utext="${title} != null?'小智慧 ['+${title}+']':'小智慧'"></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/css/adminlte.min.css">
<!--    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">-->

    <!-- DataTables -->
    <link rel="stylesheet" href="/adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="/adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <link rel="stylesheet" href="/adminlte/plugins/pace-progress/themes/black/pace-theme-loading-bar.css">

    <link rel="stylesheet" href="/css/public.css">
</head>
<body class="hold-transition layout-top-nav layout-navbar-fixed text-sm pace-primary pace-done">
<div class="pace pace-inactive">
    <div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
        <div class="pace-progress-inner"></div>
    </div>
    <div class="pace-activity"></div>
</div>
<!-- Site wrapper -->
<div id="app" class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand-md navbar-white navbar-light">
        <div class="container-md">
            <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Left navbar links -->
            <div class="collapse navbar-collapse order-3" id="navbarCollapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="../../index3.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" id="nav-1" class="nav-link">日线</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" id="nav-2" class="nav-link">周线</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" id="nav-3" class="nav-link">月线</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" id="nav-4" class="nav-link">新闻</a>
                    </li>
                </ul>

            </div>


            <!-- Right navbar links -->
            <ul class="order-1 order-md-3 navbar-nav navbar-no-expand ml-auto">
                <!-- Navbar Search -->
                <li class="nav-item">
                    <!-- SEARCH FORM -->
                    <form class="form-inline ml-0 ml-md-3">
                        <div class="input-group input-group-sm">
                            <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                            <div class="input-group-append">
                                <button class="btn btn-navbar" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </li>
                <li class="nav-item" style="display: none">
                    <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                        <i class="fas fa-search"></i>
                    </a>
                    <div class="navbar-search-block">
                        <form class="form-inline">
                            <div class="input-group input-group-sm">
                                <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-navbar" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                    <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </li>

                <!-- Messages Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-comments"></i>
                        <span class="badge badge-danger navbar-badge">3</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="../../dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Brad Diesel
                                        <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">Call me whenever you can...</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="../../dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        John Pierce
                                        <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">I got your message bro</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <!-- Message Start -->
                            <div class="media">
                                <img src="../../dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Nora Silvester
                                        <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">The subject goes here</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                            <!-- Message End -->
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
                    </div>
                </li>
                <!-- Notifications Dropdown Menu -->
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge">15</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-item dropdown-header">15 Notifications</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-envelope mr-2"></i> 4 new messages
                            <span class="float-right text-muted text-sm">3 mins</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-users mr-2"></i> 8 friend requests
                            <span class="float-right text-muted text-sm">12 hours</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-file mr-2"></i> 3 new reports
                            <span class="float-right text-muted text-sm">2 days</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="fullscreen" href="#" role="button">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <!-- /.navbar -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header"></section>

        <!-- Main content -->
        <section class="content">
            <div class="container-md"><!-- 如果要全屏:container-fluid -->
                <div class="row">
                    <div class="col-12 col-md-10" style="margin: auto">
                        <!-- Default box -->
                        <div class="card" v-if="!loading">
                            <div class="card-header">
                                <h3 v-text="title" class="card-title"></h3>
                                <div class="custom-control custom-control-inline custom-radio" style="margin-left: .5rem;margin-top: .01rem;">
                                    <input ref="refBkFilterAll" @change="filterAllBks" class="custom-control-input" type="radio" id="bk-rb-0" name="bkFilter" checked/>
                                    <label for="bk-rb-0" class="custom-control-label">全部<span v-text="' ('+total+')'"></span></label>
                                </div>
                                <div class="card-tools">
                                    <div class="btn-group ml-1">
                                        <button type="button" class="btn btn-primary btn-xs dropdown-toggle dropdown-icon" data-toggle="dropdown" aria-expanded="false">
                                            <span v-text="seletedStrategyName"></span>
                                        </button>
                                        <div class="dropdown-menu left-10" role="menu">
                                            <a v-for="strategy in common.strategies" @click="filterByStrategy(strategy.code, strategy.name)" v-text="strategy.name" class="dropdown-item"></a>
                                        </div>
                                    </div>
                                    <div class="btn-group ml-1">
                                        <button type="button" class="btn btn-primary btn-xs dropdown-toggle dropdown-icon" data-toggle="dropdown" aria-expanded="false">
                                            <span v-text="seletedRpsName"></span>
                                        </button>
                                        <div class="dropdown-menu" role="menu">
                                            <a @click="sortByRating" class="dropdown-item">按个股评分排序</a>
                                            <a @click="sortByRps01" class="dropdown-item">按板块60日涨幅排序[rps_01]</a>
                                            <div class="dropdown-divider"></div>
                                            <a v-for="rps in common.rpss" @click="sortByRps(rps.code, rps.name)" v-text="rps.name+'['+rps.code+']'" class="dropdown-item"></a>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="callout callout-info">
                                            <!-- checkbox -->
                                            <div class="form-group">
                                                <div v-for="(bk,index) in bksTopN" :key="bk.code" class="custom-control custom-control-inline custom-radio">
                                                    <input @change="filterBk(bk)" class="custom-control-input" type="radio" :id="'bk-rb-'+bk.code" name="bkFilter"/>
                                                    <label :for="'bk-rb-'+bk.code" v-text="bk.name+' ('+bk.stocks.length+')'" class="custom-control-label"></label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /.card-body -->
                            <div class="card-footer"></div>
                            <!-- /.card-footer-->
                        </div>
                        <!-- /.card -->
                    </div>
                </div>

                <div class="row">
                    <section v-for="idx in [0,1]" class="col-lg-6 connectedSortable">
                        <!-- Custom tabs (Charts with tabs)-->
                        <template v-for="(stock, index) in stocks" :key="stock.code">
                            <div class="card" v-if="index % 2 === idx">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <span v-html="stock.nameAndCodeWithLink"></span> (<span v-text="stock.order"></span>) 评分:<span v-text="stock.rating.total"></span>
                                    </h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" title="Contacts" data-widget="chat-pane-toggle">
                                            <i class="fas fa-comments"></i>
                                        </button>
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button type="button" class="btn btn-tool" data-card-widget="remove">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div><!-- /.card-header -->
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-1 col-md-1 pr-0">
                                            <div class="nav flex-column nav-tabs h-100" role="tablist" aria-orientation="vertical">
                                                <a class="nav-link active" :href="'#tab-1-'+stock.code" data-toggle="tab">日线</a>
                                                <a class="nav-link" :href="'#tab-2-'+stock.code" data-toggle="tab">周线</a>
                                                <a class="nav-link" :href="'#tab-3-'+stock.code" data-toggle="tab">月线</a>
                                                <a class="nav-link" :href="'#tab-4-'+stock.code" data-toggle="tab">新闻</a>
                                            </div>
                                        </div>
                                        <div class="col-11 col-sm-11">
                                            <div class="tab-content p-0">
                                                <div class="tab-pane active" :id="'tab-1-'+stock.code">
                                                    <span v-html="stock.dayBarImage"></span>
                                                    <span style="display: flex;margin-right: 6px;">
                                                        <img height="80" style="margin-top: -80px;width: 100%" :src="'data:image/png;base64,'+stock.dayFlowImage">
                                                    </span>
                                                </div>
                                                <div class="tab-pane" :id="'tab-2-'+stock.code">
                                                    <span v-html="stock.weekBarImage"></span>
                                                </div>
                                                <div class="tab-pane" :id="'tab-3-'+stock.code">
                                                    <span v-html="stock.monthBarImage"></span>
                                                </div>
                                                <div class="tab-pane" :id="'tab-4-'+stock.code">
                                                    <datatable :="{...common.news, ...stock.news}"></datatable>
                                                </div>

                                                <div class="tab-pane" :id="'tab-12-'+stock.code" style="display: none">
                                                    <div class="row">
                                                        <div class="col-12  col-sm-12">
                                                            <div class="d-flex justify-content-between align-items-center border-bottom">
                                                                <p class="text-info">[调研]</p>
                                                                <p class="d-flex flex-column text-right mb-0">
                                                                    <span class="font-weight-bold"><i class="ion ion-android-arrow-up text-success"></i> 12% </span>
                                                                    <span class="text-muted">CONVERSION RATE</span>
                                                                </p>
                                                            </div>
                                                            <div class="d-flex justify-content-between align-items-center border-bottom">
                                                                <p class="text-success text-xl"><i class="ion ion-ios-refresh-empty"></i></p>
                                                                <p class="d-flex flex-column text-right mb-0"><span class="font-weight-bold"><i class="ion ion-android-arrow-up text-success"></i> 12% </span><span class="text-muted">CONVERSION RATE</span></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12  col-sm-12">
                                                            <div class="float-right">
                                                                <ul class="pagination pagination-sm">
                                                                    <li class="page-item"><a href="#" class="page-link">&laquo;</a></li>
                                                                    <li class="page-item"><a href="#" class="page-link">1</a></li>
                                                                    <li class="page-item"><a href="#" class="page-link">2</a></li>
                                                                    <li class="page-item"><a href="#" class="page-link">3</a></li>
                                                                    <li class="page-item"><a href="#" class="page-link">&raquo;</a></li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><!-- /.card-body -->

                                <div class="card-footer"></div>

                            </div>
                        </template>
                        <!-- /.card -->
                    </section>
                </div>

                <div class="row" style="display: none">
                    <!-- Left col -->
                    <section class="col-lg-6 connectedSortable">
                        <!-- Custom tabs (Charts with tabs)-->

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Online Store Overview</h3>
                                <div class="card-tools">
                                    <a href="#" class="btn btn-sm btn-tool">
                                        <i class="fas fa-download"></i>
                                    </a>
                                    <a href="#" class="btn btn-sm btn-tool">
                                        <i class="fas fa-bars"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                                    <p class="text-success text-xl">
                                        <i class="ion ion-ios-refresh-empty"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                                        <span class="font-weight-bold">
                                          <i class="ion ion-android-arrow-up text-success"></i> 12%
                                        </span>
                                        <span class="text-muted">CONVERSION RATE</span>
                                    </p>
                                </div>
                                <!-- /.d-flex -->
                                <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                                    <p class="text-warning text-xl">
                                        <i class="ion ion-ios-cart-outline"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                                        <span class="font-weight-bold">
                                          <i class="ion ion-android-arrow-up text-warning"></i> 0.8%
                                        </span>
                                        <span class="text-muted">SALES RATE</span>
                                    </p>
                                </div>
                                <!-- /.d-flex -->
                                <div class="d-flex justify-content-between align-items-center mb-0">
                                    <p class="text-danger text-xl">
                                        <i class="ion ion-ios-people-outline"></i>
                                    </p>
                                    <p class="d-flex flex-column text-right">
                                        <span class="font-weight-bold">
                                          <i class="ion ion-android-arrow-down text-danger"></i> 1%
                                        </span>
                                        <span class="text-muted">REGISTRATION RATE</span>
                                    </p>
                                </div>
                                <!-- /.d-flex -->
                            </div>
                        </div>

                        <!-- TO DO List -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="ion ion-clipboard mr-1"></i>
                                    To Do List
                                </h3>

                                <div class="card-tools">
                                    <ul class="pagination pagination-sm">
                                        <li class="page-item"><a href="#" class="page-link">&laquo;</a></li>
                                        <li class="page-item"><a href="#" class="page-link">1</a></li>
                                        <li class="page-item"><a href="#" class="page-link">2</a></li>
                                        <li class="page-item"><a href="#" class="page-link">3</a></li>
                                        <li class="page-item"><a href="#" class="page-link">&raquo;</a></li>
                                    </ul>
                                </div>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <ul class="todo-list" data-widget="todo-list">
                                    <li>
                                        <!-- drag handle -->
                                        <span class="handle">
                                          <i class="fas fa-ellipsis-v"></i>
                                          <i class="fas fa-ellipsis-v"></i>
                                        </span>
                                        <!-- checkbox -->
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo1" id="todoCheck1">
                                            <label for="todoCheck1"></label>
                                        </div>
                                        <!-- todo text -->
                                        <span class="text">Design a nice theme</span>
                                        <!-- Emphasis label -->
                                        <small class="badge badge-danger"><i class="far fa-clock"></i> 2 mins</small>
                                        <!-- General tools such as edit or delete-->
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <span class="handle">
                                          <i class="fas fa-ellipsis-v"></i>
                                          <i class="fas fa-ellipsis-v"></i>
                                        </span>
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo2" id="todoCheck2" checked>
                                            <label for="todoCheck2"></label>
                                        </div>
                                        <span class="text">Make the theme responsive</span>
                                        <small class="badge badge-info"><i class="far fa-clock"></i> 4 hours</small>
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <span class="handle">
                                          <i class="fas fa-ellipsis-v"></i>
                                          <i class="fas fa-ellipsis-v"></i>
                                        </span>
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo3" id="todoCheck3">
                                            <label for="todoCheck3"></label>
                                        </div>
                                        <span class="text">Let theme shine like a star</span>
                                        <small class="badge badge-warning"><i class="far fa-clock"></i> 1 day</small>
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                    <li>
                    <span class="handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo4" id="todoCheck4">
                                            <label for="todoCheck4"></label>
                                        </div>
                                        <span class="text">Let theme shine like a star</span>
                                        <small class="badge badge-success"><i class="far fa-clock"></i> 3 days</small>
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                    <li>
                    <span class="handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo5" id="todoCheck5">
                                            <label for="todoCheck5"></label>
                                        </div>
                                        <span class="text">Check your messages and notifications</span>
                                        <small class="badge badge-primary"><i class="far fa-clock"></i> 1 week</small>
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                    <li>
                    <span class="handle">
                      <i class="fas fa-ellipsis-v"></i>
                      <i class="fas fa-ellipsis-v"></i>
                    </span>
                                        <div  class="icheck-primary d-inline ml-2">
                                            <input type="checkbox" value="" name="todo6" id="todoCheck6">
                                            <label for="todoCheck6"></label>
                                        </div>
                                        <span class="text">Let theme shine like a star</span>
                                        <small class="badge badge-secondary"><i class="far fa-clock"></i> 1 month</small>
                                        <div class="tools">
                                            <i class="fas fa-edit"></i>
                                            <i class="fas fa-trash-o"></i>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <!-- /.card-body -->
                            <div class="card-footer clearfix">
                                <button type="button" class="btn btn-primary float-right"><i class="fas fa-plus"></i> Add item</button>
                            </div>
                        </div>
                        <!-- /.card -->
                    </section>
                    <!-- /.Left col -->
                    <!-- right col (We are only adding the ID to make the widgets sortable)-->
                    <section class="col-lg-6 connectedSortable">

                        <!-- Map card -->
                        <div class="card bg-gradient-primary">
                            <div class="card-header border-0">
                                <h3 class="card-title">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    Visitors
                                </h3>
                                <!-- card tools -->
                                <div class="card-tools">
                                    <button type="button" class="btn btn-primary btn-sm daterange" title="Date range">
                                        <i class="far fa-calendar-alt"></i>
                                    </button>
                                    <button type="button" class="btn btn-primary btn-sm" data-card-widget="collapse" title="Collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                </div>
                                <!-- /.card-tools -->
                            </div>
                            <div class="card-body">
                                <div id="world-map" style="height: 250px; width: 100%;"></div>
                            </div>
                            <!-- /.card-body-->
                            <div class="card-footer bg-transparent">
                                <div class="row">
                                    <div class="col-4 text-center">
                                        <div id="sparkline-1"></div>
                                        <div class="text-white">Visitors</div>
                                    </div>
                                    <!-- ./col -->
                                    <div class="col-4 text-center">
                                        <div id="sparkline-2"></div>
                                        <div class="text-white">Online</div>
                                    </div>
                                    <!-- ./col -->
                                    <div class="col-4 text-center">
                                        <div id="sparkline-3"></div>
                                        <div class="text-white">Sales</div>
                                    </div>
                                    <!-- ./col -->
                                </div>
                                <!-- /.row -->
                            </div>
                        </div>
                        <!-- /.card -->

                        <!-- solid sales graph -->
                        <div class="card bg-gradient-info">
                            <div class="card-header border-0">
                                <h3 class="card-title">
                                    <i class="fas fa-th mr-1"></i>
                                    Sales Graph
                                </h3>

                                <div class="card-tools">
                                    <button type="button" class="btn bg-info btn-sm" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn bg-info btn-sm" data-card-widget="remove">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas class="chart" id="line-chart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                            </div>
                            <!-- /.card-body -->
                            <div class="card-footer bg-transparent">
                                <div class="row">
                                    <div class="col-4 text-center">
                                        <input type="text" class="knob" data-readonly="true" value="20" data-width="60" data-height="60"
                                               data-fgColor="#39CCCC">

                                        <div class="text-white">Mail-Orders</div>
                                    </div>
                                    <!-- ./col -->
                                    <div class="col-4 text-center">
                                        <input type="text" class="knob" data-readonly="true" value="50" data-width="60" data-height="60"
                                               data-fgColor="#39CCCC">

                                        <div class="text-white">Online</div>
                                    </div>
                                    <!-- ./col -->
                                    <div class="col-4 text-center">
                                        <input type="text" class="knob" data-readonly="true" value="30" data-width="60" data-height="60"
                                               data-fgColor="#39CCCC">

                                        <div class="text-white">In-Store</div>
                                    </div>
                                    <!-- ./col -->
                                </div>
                                <!-- /.row -->
                            </div>
                            <!-- /.card-footer -->
                        </div>
                        <!-- /.card -->

                        <!-- Calendar -->
                        <div class="card bg-gradient-success">
                            <div class="card-header border-0">

                                <h3 class="card-title">
                                    <i class="far fa-calendar-alt"></i>
                                    Calendar
                                </h3>
                                <!-- tools card -->
                                <div class="card-tools">
                                    <!-- button with a dropdown -->
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown" data-offset="-52">
                                            <i class="fas fa-bars"></i>
                                        </button>
                                        <div class="dropdown-menu" role="menu">
                                            <a href="#" class="dropdown-item">Add new event</a>
                                            <a href="#" class="dropdown-item">Clear events</a>
                                            <div class="dropdown-divider"></div>
                                            <a href="#" class="dropdown-item">View calendar</a>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-success btn-sm" data-card-widget="collapse">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-success btn-sm" data-card-widget="remove">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <!-- /. tools -->
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body pt-0">
                                <!--The calendar -->
                                <div id="calendar" style="width: 100%"></div>
                            </div>
                            <!-- /.card-body -->
                        </div>
                        <!-- /.card -->
                    </section>
                    <!-- right col -->
                </div>

            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <footer class="main-footer">
        <div class="container">
            <div class="float-right d-none d-sm-block">
                <b>Version</b> 3.1.0
            </div>
            <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
        </div>
    </footer>

</div>
<!-- ./wrapper -->
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@3.1.1/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>

<script src="/adminlte/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="/adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="/adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="/adminlte/plugins/pace-progress/pace.min.js"></script>

<script src="/js/component/datatable.js"></script>

<script th:inline="javascript">
    const title = [[${title}]];
    const code = [[${code}]];
    const codeType = [[${codeType}]];

    function parseStocks(_this, res){
        let data = res.data.data;
        console.log(data);
        let stocks = data.stocks;
        let i = 1;
        stocks.forEach(stock => {
            stock.order = i++;
            stock.news.forEach(n => {
                n.type = '['+n.dict.text+']';
                n.title = '<a target="_blank" href="'+n.urlTarget+'">'+n.title+'</a>';
            })
            stock.news = {data: stock.news}
        });
        _this.stocks = stocks;
        _this._stocks = stocks;
        _this.bks = data.bks;
        _this._bks = data.bks;
        _this.loading = false;
        console.log(_this.$data);
    }

    const app = Vue.createApp({
        data() {
            return {
                title: title,
                loading: true,
                seletedRpsName: 'RPS排序',
                seletedStrategyName: 'Strategy过滤',
                common:{
                    news:{
                        columns: [{data:"type"},{data:"title"},{data:"infoCreateTime"}],
                        ordering: false,
                        //columns: [{title:"a"},{title:"b"}],
                        columnDefs: [
                            { className: "text-nowrap", "targets": [ 0,2 ] }
                        ]
                    }
                },
                total:0,
                stocks:[],
                bks:[]
            }
        },
        methods:{
            okMethods:function (){
                console.log("ok")
            },
            cancelMethods:function (){
                console.log("cancel")
            },
            clickRps:function () {
                this.$refs.btnRps.click();
            },
            filterAllBks:function (){
                if (this.$refs.refBkFilterAll.checked) {
                    this.stocks = this._stocks;
                } else {
                    this.stocks = [];
                }
            },
            filterBk:function (bk) {
                Pace.start();
                this.stocks = this._stocks.filter(stock => stock.bks.find(bk1 => bk1.code==bk.code));
                Pace.stop();
            },
            filterStocks:function (code){
                this.stocks = this._stocks.filter(stock => stock.code==code)
            },
            filterByStrategy:function (strategyCode, strategyName){
                Pace.start();
                this.seletedStrategyName = strategyName+'['+strategyCode+']';
                let _this = this;
                axios.get("/strategy/"+strategyCode+"/"+codeType+"/"+code).then(function (res) {
                    parseStocks(_this, res);
                });
                Pace.stop();
            },
            sortByRating:function (e) {
                Pace.start();
                this.seletedRpsName = e.target.innerText;
                this.stocks = this.stocks.concat().sort((a, b) => b.rating.total - a.rating.total)
                Pace.stop();
            },
            sortByRps01:function (e) {
                Pace.start();
                this.seletedRpsName = e.target.innerText;
                this.stocks = this.stocks.concat().sort((a, b) => {
                    let n = Math.max(...b.bks.map(bk => bk.rps.rps_01.percentile)) - Math.max(...a.bks.map(bk => bk.rps.rps_01.percentile));
                    if(n === 0){
                        n = b.rating.total - a.rating.total;
                    }
                    return n
                })
                Pace.stop();
            },
            sortByRps:function (rpsCode, rpsName){
                Pace.start();
                this.seletedRpsName = rpsName+'['+rpsCode+']';
                let _this = this;
                axios.get("/rps/"+rpsCode+"/"+codeType+"/"+code).then(function (res) {
                    parseStocks(_this, res);
                });
                Pace.stop();
            }
        },
        computed: {
            bksTopN: function () {
                return this.bks.slice(0, 10);
            }  
        },
        mounted() {
            let _this = this;
            axios.get("/rps/list").then(function(res){
                _this.common.rpss = res.data.data;
            });

            axios.get("/strategy/list").then(function(res){
                _this.common.strategies = res.data.data;
            });

            axios.get("/"+codeType+"/" + code).then(function (res) {
                parseStocks(_this, res);
                _this.total = _this.stocks.length;
                console.log('mounted')
            });

            /*this.bks = [
                {code:'BK0825',name:"新零售[BK0825]", stocks:['600600']},
                {code:'BK0549',name:"深圳特区[BK0549]", stocks:['002620']}
            ];
            this.stocks = [
                {
                    cate: "STOCK",
                    code: "002620",
                    dayBarImage: "<a target='_blank' href='https://xueqiu.com/S/SZ002620'><img width='100%' src='http://webquoteklinepic.eastmoney.com/GetPic.aspx?nid=0.002620&UnitWidth=-6&imageType=KXL&EF=&Formula=MACD&AT=1&&type=D&token=&_=1627286644203' /></a>",
                    dayFlowImage: "",
                    market: "CN",
                    monthBarImage: "<a target='_blank' href='https://xueqiu.com/S/SZ002620'><img width='100%' src='http://webquoteklinepic.eastmoney.com/GetPic.aspx?nid=0.002620&UnitWidth=-6&imageType=KXL&EF=&Formula=MACD&AT=1&&type=M&token=&_=1627286644203' /></a>",
                    name: "瑞和股份",
                    nameAndCodeWithLink: "<a target='_blank' href='https://xueqiu.com/S/SZ002620'>瑞和股份</a>[<a target='_blank' href='http://81.68.255.181:8088/stk?s=002620'>SZ002620</a>]",
                    news: {data: []},
                    order: 1,
                    place: "SZ",
                    rating:{
                        root: {type: "stock", score: 74, nodes: []},
                        total: 74
                    }
                },
            ];
            this.loading = false;*/
        },
        created () {
        },
        beforeCreate(){
            console.log('beforeCreate')
        },
        updated(){
            console.log('updated')
        }
    });

    app.component('datatable', _datatable);
    app.mount('#app');

    $("[id^='nav-']").click(function (e) {
        e.preventDefault();
        var flag = $(this).prop("id").substring(3,6);
        $("[href^='#tab"+flag+"']").click()
    });
</script>

